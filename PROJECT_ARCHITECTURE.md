# å°çº¢ä¹¦åˆ›ä½œè€…åˆ†æå¹³å° - é¡¹ç›®æ¶æ„æ–‡æ¡£

> æœ€åæ›´æ–°ï¼š2025-07  
> ç‰ˆæœ¬ï¼š2.0.0

---

## ç›®å½•

- [1. é¡¹ç›®æ¦‚è§ˆ](#1-é¡¹ç›®æ¦‚è§ˆ)
- [2. æŠ€æœ¯æ ˆ](#2-æŠ€æœ¯æ ˆ)
- [3. ç›®å½•ç»“æ„](#3-ç›®å½•ç»“æ„)
- [4. åç«¯æ¶æ„](#4-åç«¯æ¶æ„)
  - [4.1 ä¸‰å±‚æ¶æ„](#41-ä¸‰å±‚æ¶æ„)
  - [4.2 API ç«¯ç‚¹åˆ—è¡¨](#42-api-ç«¯ç‚¹åˆ—è¡¨)
  - [4.3 æœåŠ¡å±‚è¯¦è§£](#43-æœåŠ¡å±‚è¯¦è§£)
  - [4.4 LLM Gateway](#44-llm-gateway)
  - [4.5 æ•°æ®é‡‡é›†å™¨](#45-æ•°æ®é‡‡é›†å™¨)
- [5. å‰ç«¯æ¶æ„](#5-å‰ç«¯æ¶æ„)
  - [5.1 è·¯ç”±ç»“æ„](#51-è·¯ç”±ç»“æ„)
  - [5.2 ç»„ä»¶åˆ—è¡¨](#52-ç»„ä»¶åˆ—è¡¨)
  - [5.3 API ä»£ç†è·¯ç”±](#53-api-ä»£ç†è·¯ç”±)
  - [5.4 å›½é™…åŒ– (i18n)](#54-å›½é™…åŒ–-i18n)
- [6. æ•°æ®åº“è®¾è®¡](#6-æ•°æ®åº“è®¾è®¡)
  - [6.1 MongoDB é›†åˆåˆ—è¡¨](#61-mongodb-é›†åˆåˆ—è¡¨)
  - [6.2 Repository å±‚æ˜ å°„](#62-repository-å±‚æ˜ å°„)
  - [6.3 æ•°æ®æ¨¡å‹å®šä¹‰](#63-æ•°æ®æ¨¡å‹å®šä¹‰)
  - [6.4 æ•°æ®æµå‘å›¾](#64-æ•°æ®æµå‘å›¾)
- [7. ç¯å¢ƒå˜é‡é…ç½®](#7-ç¯å¢ƒå˜é‡é…ç½®)
- [8. åç«¯è„šæœ¬å·¥å…·](#8-åç«¯è„šæœ¬å·¥å…·)
- [9. éƒ¨ç½²è¯´æ˜](#9-éƒ¨ç½²è¯´æ˜)
- [10. å·²çŸ¥é—®é¢˜ä¸æ³¨æ„äº‹é¡¹](#10-å·²çŸ¥é—®é¢˜ä¸æ³¨æ„äº‹é¡¹)

---

## 1. é¡¹ç›®æ¦‚è§ˆ

**å°çº¢ä¹¦åˆ›ä½œè€…åˆ†æå¹³å°**æ˜¯ä¸€ä¸ªå…¨æ ˆ AI åº”ç”¨ï¼Œæ ¸å¿ƒåŠŸèƒ½åŒ…æ‹¬ï¼š

| åŠŸèƒ½æ¨¡å— | è¯´æ˜ |
|---------|------|
| **åˆ›ä½œè€…å…³ç³»ç½‘ç»œ** | å¯è§†åŒ–åˆ›ä½œè€…ä¹‹é—´çš„å…³è”å…³ç³»ï¼ˆD3 åŠ›å¯¼å‘å›¾ï¼‰ |
| **å†…å®¹å·¥ä½œå®¤ (Content Studio)** | é€‰æ‹©åˆ›ä½œè€… â†’ åŒ¹é…é£æ ¼ â†’ å‘ç°å†…å®¹çµæ„Ÿ â†’ AI ç”Ÿæˆå†…å®¹ |
| **æˆé•¿è·¯å¾„åˆ†æ** | åŸºäºç«å“å¯¹æ¯”ï¼Œè§„åˆ’åˆ›ä½œè€…æˆé•¿è·¯å¾„ |
| **ç”¨æˆ·ç”»åƒåˆ†æ** | AI åˆ†æåˆ›ä½œè€…ç”»åƒæ ‡ç­¾ã€å—ä¼—ç‰¹å¾ |

**æ•°æ®æ¥æº**ï¼šé€šè¿‡ TikHub API é‡‡é›†å°çº¢ä¹¦å¹³å°ç”¨æˆ·ç¬”è®°æ•°æ®ï¼Œå­˜å‚¨äº MongoDB Atlasã€‚

---

## 2. æŠ€æœ¯æ ˆ

### åç«¯

| ç»„ä»¶ | æŠ€æœ¯ | ç‰ˆæœ¬ |
|------|------|------|
| Web æ¡†æ¶ | FastAPI | 0.109.0 |
| ASGI æœåŠ¡å™¨ | uvicorn | 0.27.0 |
| æ•°æ®åº“é©±åŠ¨ | PyMongo | 4.6.1 |
| DNS è§£æ | dnspython | 2.5.0 |
| AI æ¨¡å‹è°ƒç”¨ | OpenAI SDK (DeepSeek) | â‰¥1.30.0 |
| å‘é‡åµŒå…¥ | sentence-transformers | â‰¥2.2.2 |
| åµŒå…¥æ¨¡å‹ | BAAI/bge-small-zh-v1.5 | 512 ç»´ |
| æ·±åº¦å­¦ä¹ æ¡†æ¶ | PyTorch | â‰¥2.0.0 |
| ç¯å¢ƒå˜é‡ | python-dotenv + pydantic-settings | 1.0.0 / 2.1.0 |
| å®šæ—¶ä»»åŠ¡ | APScheduler | 3.10.4 |
| HTTP å®¢æˆ·ç«¯ | requests | 2.31.0 |

### å‰ç«¯

| ç»„ä»¶ | æŠ€æœ¯ | ç‰ˆæœ¬ |
|------|------|------|
| æ¡†æ¶ | Next.js | 16.1.0 |
| UI åº“ | React | 19.1.0 |
| è¯­è¨€ | TypeScript | ^5 |
| CSS æ–¹æ¡ˆ | TailwindCSS | ^4 |
| å›¾è¡¨åº“ | Recharts | ^3.2.0 |
| åŠ›å°å‘å›¾ | d3-force | ^3.0.0 |
| å›½é™…åŒ– | next-intl | ^4.3.7 |
| åŒ…ç®¡ç†å™¨ | pnpm | â€” |
| éƒ¨ç½²å¹³å° | Vercel | â€” |

### åŸºç¡€è®¾æ–½

| ç»„ä»¶ | æŠ€æœ¯ | å¤‡æ³¨ |
|------|------|------|
| æ•°æ®åº“ | MongoDB Atlas | é›†ç¾¤: `xhs-cluster.omeyngi.mongodb.net` |
| æ•°æ®åº“å | `tikhub_xhs` | 10 ä¸ªé›†åˆ |
| LLM æœåŠ¡ | DeepSeek Chat | `deepseek-chat` æ¨¡å‹ |
| æ•°æ®é‡‡é›† | TikHub API | å°çº¢ä¹¦ Web API |

---

## 3. ç›®å½•ç»“æ„

```
xhs_data_Project/
â”œâ”€â”€ .env                          # ç¯å¢ƒå˜é‡ï¼ˆæ•æ„Ÿä¿¡æ¯ï¼Œä¸æäº¤ï¼‰
â”œâ”€â”€ .env.example                  # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”œâ”€â”€ .gitignore                    # Git å¿½ç•¥è§„åˆ™
â”œâ”€â”€ PROJECT_ARCHITECTURE.md       # ğŸ“Œ æœ¬æ–‡æ¡£
â”œâ”€â”€ README.md                     # é¡¹ç›®ç®€ä»‹
â”‚
â”œâ”€â”€ backend/                      # ğŸ”§ åç«¯æœåŠ¡ (FastAPI)
â”‚   â”œâ”€â”€ Dockerfile                # Docker æ„å»ºæ–‡ä»¶
â”‚   â”œâ”€â”€ requirements.txt          # Python ä¾èµ–
â”‚   â”œâ”€â”€ start_server.sh           # å¯åŠ¨è„šæœ¬ï¼ˆè‡ªåŠ¨æ£€æµ‹ç«¯å£å†²çªï¼‰
â”‚   â”‚
â”‚   â”œâ”€â”€ api/                      # API æ¥å£å±‚
â”‚   â”‚   â”œâ”€â”€ server.py             # FastAPI ä¸»å…¥å£ï¼ˆæ³¨å†Œè·¯ç”±ã€CORSï¼‰
â”‚   â”‚   â”œâ”€â”€ routers/              # è·¯ç”±æ¨¡å—
â”‚   â”‚   â”‚   â”œâ”€â”€ creator_router.py # åˆ›ä½œè€…æ•°æ®è·¯ç”± (/api/creators/*)
â”‚   â”‚   â”‚   â”œâ”€â”€ style_router.py   # é£æ ¼ç”Ÿæˆè·¯ç”± (/api/style/*)
â”‚   â”‚   â”‚   â”œâ”€â”€ persona_router.py # ç”¨æˆ·ç”»åƒè·¯ç”± (/api/persona/*)
â”‚   â”‚   â”‚   â””â”€â”€ growth_path.py    # æˆé•¿è·¯å¾„è·¯ç”± (/api/creators/growth-path/*)
â”‚   â”‚   â””â”€â”€ services/             # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”‚       â”œâ”€â”€ style_service.py  # é£æ ¼ç”ŸæˆæœåŠ¡ï¼ˆAI å†…å®¹ç”Ÿæˆï¼‰
â”‚   â”‚       â”œâ”€â”€ persona_service.py# ç”¨æˆ·ç”»åƒåˆ†ææœåŠ¡
â”‚   â”‚       â””â”€â”€ growth_path_service.py # æˆé•¿è·¯å¾„åˆ†ææœåŠ¡
â”‚   â”‚
â”‚   â”œâ”€â”€ core/                     # æ ¸å¿ƒæ¨¡å—
â”‚   â”‚   â”œâ”€â”€ config.py             # é›†ä¸­åŒ–é…ç½®ç®¡ç† (Pydantic Settings)
â”‚   â”‚   â”œâ”€â”€ llm_gateway.py        # LLM ç½‘å…³ï¼ˆç¼“å­˜ + å‹ç¼© + é™æµï¼‰
â”‚   â”‚   â””â”€â”€ storage.py            # å­˜å‚¨å±‚ï¼ˆLocal / S3 è„šæ‰‹æ¶ï¼‰
â”‚   â”‚
â”‚   â”œâ”€â”€ database/                 # æ•°æ®è®¿é—®å±‚
â”‚   â”‚   â”œâ”€â”€ connection.py         # MongoDB è¿æ¥ç®¡ç†ï¼ˆå•ä¾‹ + è¶…æ—¶é…ç½®ï¼‰
â”‚   â”‚   â”œâ”€â”€ models.py             # Pydantic æ•°æ®æ¨¡å‹ï¼ˆ16 ä¸ªæ¨¡å‹ï¼‰
â”‚   â”‚   â”œâ”€â”€ repositories.py       # Repository æ¨¡å¼ï¼ˆ6 ä¸ªä»“åº“ç±»ï¼‰
â”‚   â”‚   â””â”€â”€ migrate_data.py       # æ•°æ®è¿ç§»å·¥å…·
â”‚   â”‚
â”‚   â”œâ”€â”€ scripts/                  # å·¥å…·è„šæœ¬ï¼ˆä¸€æ¬¡æ€§ / ç»´æŠ¤ç”¨ï¼‰
â”‚   â”‚   â”œâ”€â”€ regenerate_creator_networks.py  # â­ é‡å»ºåˆ›ä½œè€…ç½‘ç»œ
â”‚   â”‚   â”œâ”€â”€ create_indexes.py               # åˆ›å»º MongoDB ç´¢å¼•
â”‚   â”‚   â”œâ”€â”€ generate_missing_embeddings.py  # ç”Ÿæˆç¼ºå¤±çš„å‘é‡åµŒå…¥
â”‚   â”‚   â””â”€â”€ ... (å…± 20 ä¸ªè„šæœ¬)
â”‚   â”‚
â”‚   â””â”€â”€ tasks/                    # å®šæ—¶ä»»åŠ¡
â”‚       â””â”€â”€ collector_task.py     # æ•°æ®é‡‡é›†å®šæ—¶ä»»åŠ¡
â”‚
â”œâ”€â”€ collectors/                   # ğŸ“Š æ•°æ®é‡‡é›†æ¨¡å—
â”‚   â””â”€â”€ xiaohongshu/
â”‚       â”œâ”€â”€ collector.py          # å°çº¢ä¹¦æ•°æ®é‡‡é›†å™¨ï¼ˆTikHub APIï¼‰
â”‚       â”œâ”€â”€ analyzer.py           # æ•°æ®åˆ†æå™¨
â”‚       â”œâ”€â”€ pipeline.py           # æ•°æ®å¤„ç†ç®¡é“
â”‚       â””â”€â”€ test_tikhub_api.py    # API æµ‹è¯•è„šæœ¬
â”‚
â””â”€â”€ xhs-analyser-frontend/       # ğŸ¨ å‰ç«¯åº”ç”¨ (Next.js)
    â”œâ”€â”€ package.json              # ä¾èµ–é…ç½®
    â”œâ”€â”€ next.config.ts            # Next.js é…ç½®ï¼ˆå« next-intl æ’ä»¶ï¼‰
    â”œâ”€â”€ vercel.json               # Vercel éƒ¨ç½²é…ç½®
    â”œâ”€â”€ tsconfig.json             # TypeScript é…ç½®
    â”‚
    â”œâ”€â”€ app/                      # Next.js App Router
    â”‚   â”œâ”€â”€ layout.tsx            # æ ¹å¸ƒå±€ï¼ˆGoogle Fonts åŠ è½½ï¼‰
    â”‚   â”œâ”€â”€ page.tsx              # æ ¹é¡µé¢ï¼ˆé‡å®šå‘åˆ° /zhï¼‰
    â”‚   â”œâ”€â”€ [locale]/             # å›½é™…åŒ–è·¯ç”±
    â”‚   â”‚   â”œâ”€â”€ layout.tsx        # è¯­è¨€å¸ƒå±€ï¼ˆNextIntlClientProviderï¼‰
    â”‚   â”‚   â”œâ”€â”€ page.tsx          # é¦–é¡µ â†’ HomePage ç»„ä»¶
    â”‚   â”‚   â”œâ”€â”€ content-studio/   # å†…å®¹å·¥ä½œå®¤é¡µé¢
    â”‚   â”‚   â”œâ”€â”€ growth-path/      # æˆé•¿è·¯å¾„é¡µé¢
    â”‚   â”‚   â””â”€â”€ style-generator/  # é£æ ¼ç”Ÿæˆå™¨é¡µé¢
    â”‚   â””â”€â”€ api/                  # API ä»£ç†è·¯ç”±ï¼ˆNext.js â†’ FastAPIï¼‰
    â”‚       â”œâ”€â”€ creators/route.ts # â†’ /api/creators/network
    â”‚       â””â”€â”€ style/creators/route.ts # â†’ /api/style/creators
    â”‚
    â”œâ”€â”€ src/
    â”‚   â”œâ”€â”€ i18n.ts               # å›½é™…åŒ–é…ç½®
    â”‚   â”œâ”€â”€ middleware.ts         # è¯­è¨€ä¸­é—´ä»¶ï¼ˆé»˜è®¤ zhï¼‰
    â”‚   â”œâ”€â”€ navigation.ts        # å¯¼èˆªå·¥å…·ï¼ˆLink, useRouter ç­‰ï¼‰
    â”‚   â”œâ”€â”€ app/
    â”‚   â”‚   â””â”€â”€ globals.css       # TailwindCSS å…¨å±€æ ·å¼
    â”‚   â”œâ”€â”€ components/           # ç»„ä»¶åº“
    â”‚   â”‚   â”œâ”€â”€ HomePage.tsx      # é¦–é¡µï¼ˆè‹±é›„åŒº + åˆ›ä½œè€…ç½‘ç»œå›¾ï¼‰
    â”‚   â”‚   â”œâ”€â”€ ContentStudio.tsx # å†…å®¹å·¥ä½œå®¤ï¼ˆ4 æ­¥å·¥ä½œæµï¼‰
    â”‚   â”‚   â”œâ”€â”€ CreatorNetworkGraph.tsx # D3 åŠ›å°å‘å›¾
    â”‚   â”‚   â”œâ”€â”€ CreatorUniverse.tsx     # åˆ›ä½œè€…å®‡å®™è§†å›¾
    â”‚   â”‚   â”œâ”€â”€ Header.tsx        # å¯¼èˆªæ  + è¯­è¨€åˆ‡æ¢
    â”‚   â”‚   â”œâ”€â”€ LanguageSwitcher.tsx    # è¯­è¨€åˆ‡æ¢ç»„ä»¶
    â”‚   â”‚   â””â”€â”€ workflow/         # å·¥ä½œæµæ­¥éª¤ç»„ä»¶
    â”‚   â”‚       â”œâ”€â”€ StepSelectCreator.tsx    # æ­¥éª¤1: é€‰æ‹©åˆ›ä½œè€…
    â”‚   â”‚       â”œâ”€â”€ StepMatchCreators.tsx    # æ­¥éª¤2: åŒ¹é…åˆ›ä½œè€…
    â”‚   â”‚       â”œâ”€â”€ StepDiscoverContent.tsx  # æ­¥éª¤3: å‘ç°å†…å®¹çµæ„Ÿ
    â”‚   â”‚       â””â”€â”€ StepGenerateContent.tsx  # æ­¥éª¤4: AI ç”Ÿæˆå†…å®¹
    â”‚   â”œâ”€â”€ data/                 # é™æ€æ•°æ®ï¼ˆå¤‡ç”¨ï¼‰
    â”‚   â”‚   â””â”€â”€ creators.ts       # åˆ›ä½œè€…é™æ€æ•°æ®ï¼ˆå·²æ”¹ä¸º API åŠ è½½ï¼‰
    â”‚   â””â”€â”€ lib/
    â”‚       â””â”€â”€ api.ts            # API å®¢æˆ·ç«¯å°è£…ï¼ˆfetch + ç±»å‹å®šä¹‰ï¼‰
    â”‚
    â””â”€â”€ messages/                 # å›½é™…åŒ–ç¿»è¯‘æ–‡ä»¶
        â”œâ”€â”€ en.json               # è‹±æ–‡
        â””â”€â”€ zh.json               # ä¸­æ–‡
```

---

## 4. åç«¯æ¶æ„

### 4.1 ä¸‰å±‚æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  API å±‚ (Routers)                             â”‚
â”‚  FastAPI è·¯ç”±ï¼Œå¤„ç† HTTP è¯·æ±‚/å“åº”              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Service å±‚ (Services)                        â”‚
â”‚  ä¸šåŠ¡é€»è¾‘ï¼šAI è°ƒç”¨ã€æ•°æ®ç»„è£…ã€ç¼“å­˜ç®¡ç†           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Database å±‚ (Repositories + Models)          â”‚
â”‚  MongoDB CRUDã€æ•°æ®æ¨¡å‹å®šä¹‰                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                    â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
    â”‚ MongoDB â”‚        â”‚ DeepSeek   â”‚
    â”‚  Atlas  â”‚        â”‚ LLM API    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 API ç«¯ç‚¹åˆ—è¡¨

#### åˆ›ä½œè€…è·¯ç”± (`creator_router.py`)

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| GET | `/api/creators/network` | è·å–åˆ›ä½œè€…å…³ç³»ç½‘ç»œï¼ˆ5 åˆ†é’Ÿç¼“å­˜ï¼‰ |
| GET | `/api/creators/list` | è·å–åˆ›ä½œè€…åˆ—è¡¨ |
| GET | `/api/creators/{creator_name}` | è·å–åˆ›ä½œè€…è¯¦æƒ… |
| GET | `/api/creators/{creator_name}/notes` | è·å–åˆ›ä½œè€…ç¬”è®° |
| GET | `/api/creators/embedding/search` | å‘é‡ç›¸ä¼¼åº¦æœç´¢ |

#### é£æ ¼ç”Ÿæˆè·¯ç”± (`style_router.py`)

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| GET | `/api/style/creators` | è·å–å¯æ¨¡ä»¿çš„åˆ›ä½œè€…åˆ—è¡¨ |
| POST | `/api/style/creators/clear-cache` | æ¸…é™¤åˆ›ä½œè€…åˆ—è¡¨ç¼“å­˜ |
| POST | `/api/style/generate` | AI ç”Ÿæˆé£æ ¼åŒ–å†…å®¹ |
| GET | `/api/style/prompts` | è·å–æç¤ºè¯æ¨¡æ¿åˆ—è¡¨ |
| POST | `/api/style/prompts` | åˆ›å»ºæ–°æç¤ºè¯æ¨¡æ¿ |
| GET | `/api/style/prompts/{prompt_id}` | è·å–æŒ‡å®šæ¨¡æ¿è¯¦æƒ… |

#### ç”¨æˆ·ç”»åƒè·¯ç”± (`persona_router.py`)

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| POST | `/api/persona/analyze` | AI åˆ†æç”¨æˆ·ç”»åƒ |
| GET | `/api/persona/{user_id}` | è·å–å·²æœ‰ç”»åƒ |
| GET | `/api/persona` | è·å–æ‰€æœ‰ç”»åƒåˆ—è¡¨ |
| DELETE | `/api/persona/{user_id}` | åˆ é™¤ç”¨æˆ·ç”»åƒ |
| POST | `/api/persona/batch-analyze` | æ‰¹é‡ç”»åƒåˆ†æ |

#### æˆé•¿è·¯å¾„è·¯ç”± (`growth_path.py`)

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| GET | `/api/creators/growth-path/{my_user_id}/{competitor_user_id}` | ç”Ÿæˆæˆé•¿è·¯å¾„åˆ†æ |
| GET | `/api/creators/competitors/{user_id}` | æ¨èç«å“åˆ›ä½œè€… |

#### é€šç”¨ç«¯ç‚¹

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| GET | `/` | API æ ¹è·¯å¾„ï¼ˆç‰ˆæœ¬ä¿¡æ¯ + ç«¯ç‚¹åˆ—è¡¨ï¼‰ |
| GET | `/docs` | Swagger æ–‡æ¡£ |
| GET | `/redoc` | ReDoc æ–‡æ¡£ |

### 4.3 æœåŠ¡å±‚è¯¦è§£

#### `StyleGenerationService`

å†…å®¹å·¥ä½œå®¤çš„æ ¸å¿ƒæœåŠ¡ï¼Œè´Ÿè´£ AI å†…å®¹ç”Ÿæˆã€‚

| æ–¹æ³• | è¯´æ˜ |
|------|------|
| `get_available_creators()` | ä» `creator_networks` è·å–å¯æ¨¡ä»¿åˆ›ä½œè€…åˆ—è¡¨ï¼ˆå¸¦ç¼“å­˜ï¼‰ |
| `load_creator_profile(name)` | ä» `creator_networks` åŠ è½½åˆ›ä½œè€…æ¡£æ¡ˆä¿¡æ¯ |
| `load_creator_notes(name)` | ä» `creator_networks.indexSeries` åŠ è½½åˆ›ä½œè€…å†…å®¹æ•°æ® |
| `generate_style_content(...)` | è°ƒç”¨ DeepSeek ç”Ÿæˆé£æ ¼åŒ–å†…å®¹ |
| `_build_style_prompt(...)` | æ„å»ºé£æ ¼ç”Ÿæˆæç¤ºè¯ |
| `get_prompt_templates()` | è·å–æç¤ºè¯æ¨¡æ¿åˆ—è¡¨ |
| `create_prompt_template(...)` | åˆ›å»ºæ–°æç¤ºè¯æ¨¡æ¿ |

> **é‡è¦**ï¼š`load_creator_profile` å’Œ `load_creator_notes` å·²ä»æŸ¥è¯¢ `user_profiles`/`user_snapshots` æ”¹ä¸ºè¯»å– `creator_networks` é›†åˆï¼Œä»¥é¿å… MongoDB Atlas SSL è¶…æ—¶é—®é¢˜ã€‚

#### `GrowthPathService`

| æ–¹æ³• | è¯´æ˜ |
|------|------|
| `analyze_growth_path(my_id, competitor_id)` | å¯¹æ¯”åˆ†æä¸¤ä¸ªåˆ›ä½œè€…ï¼Œç”Ÿæˆæˆé•¿è·¯å¾„å»ºè®® |
| `find_competitors(user_id)` | åŸºäºå‘é‡ç›¸ä¼¼åº¦æ¨èç«å“åˆ›ä½œè€… |
| `_build_growth_prompt(...)` | æ„å»ºæˆé•¿è·¯å¾„åˆ†ææç¤ºè¯ |

#### `PersonaAnalysisService`

| æ–¹æ³• | è¯´æ˜ |
|------|------|
| `analyze_persona(user_id)` | AI åˆ†æç”¨æˆ·ç”»åƒ |
| `get_persona(user_id)` | è·å–å·²æœ‰ç”»åƒ |
| `list_personas()` | åˆ—å‡ºæ‰€æœ‰ç”»åƒ |
| `delete_persona(user_id)` | åˆ é™¤ç”»åƒ |
| `batch_analyze(user_ids)` | æ‰¹é‡åˆ†æç”»åƒ |
| `_extract_tags(...)` | æå–ç”»åƒæ ‡ç­¾ |
| `_analyze_activity(...)` | åˆ†ææ´»è·ƒæ¨¡å¼ |
| `_analyze_audience(...)` | åˆ†æå—ä¼—ç‰¹å¾ |
| `_generate_recommendations(...)` | ç”Ÿæˆä¼˜åŒ–å»ºè®® |
| `_build_persona_prompt(...)` | æ„å»ºç”»åƒåˆ†ææç¤ºè¯ |
| `_calculate_quality_score(...)` | è®¡ç®—å†…å®¹è´¨é‡è¯„åˆ† |

### 4.4 LLM Gateway

**æ–‡ä»¶**: `backend/core/llm_gateway.py`

LLM ç½‘å…³å°è£…äº†æ‰€æœ‰ AI è°ƒç”¨ï¼Œæä¾›ä¸‰å¤§ä¼˜åŒ–èƒ½åŠ›ï¼š

| èƒ½åŠ› | å®ç° | é…ç½® |
|------|------|------|
| **ç¼“å­˜** | MongoDB é›†åˆ `llm_cache` | TTL: 24 å°æ—¶ |
| **é™æµ** | Token Bucket ä»¤ç‰Œæ¡¶ç®—æ³• | å®¹é‡ 100ï¼Œæ¯ç§’è¡¥å…… 10 |
| **æç¤ºè¯å‹ç¼©** | å†…ç½®å‹ç¼©é€»è¾‘ | è‡ªåŠ¨å»é™¤å¤šä½™ç©ºç™½ |

**è°ƒç”¨é“¾**ï¼š
```
Service â†’ LLMGateway.chat(prompt) 
  â†’ æ£€æŸ¥ç¼“å­˜ (llm_cache é›†åˆ)
  â†’ å‘½ä¸­ â†’ è¿”å›ç¼“å­˜ç»“æœ
  â†’ æœªå‘½ä¸­ â†’ é™æµæ£€æŸ¥ â†’ è°ƒç”¨ DeepSeek API â†’ å­˜å…¥ç¼“å­˜ â†’ è¿”å›
```

**LLM é…ç½®**ï¼š
- æ¨¡å‹ï¼š`deepseek-chat`
- APIï¼š`https://api.deepseek.com`ï¼ˆå…¼å®¹ OpenAI SDKï¼‰
- è¶…æ—¶ï¼š30 ç§’
- é»˜è®¤å‚æ•°ï¼š`max_tokens=1000`, `temperature=0.7`

### 4.5 æ•°æ®é‡‡é›†å™¨

**ç›®å½•**: `collectors/xiaohongshu/`

| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| `collector.py` | ä¸»é‡‡é›†å™¨ï¼Œé€šè¿‡ TikHub API è·å–ç”¨æˆ·ç¬”è®°åˆ—è¡¨å’Œç”¨æˆ·ä¿¡æ¯ |
| `analyzer.py` | æ•°æ®åˆ†æå™¨ï¼Œå¯¹é‡‡é›†æ•°æ®åšæ±‡æ€»åˆ†æ |
| `pipeline.py` | æ•°æ®å¤„ç†ç®¡é“ï¼Œç¼–æ’ é‡‡é›† â†’ åˆ†æ â†’ å­˜å‚¨ æµç¨‹ |
| `test_tikhub_api.py` | API è¿é€šæ€§æµ‹è¯• |

**é‡‡é›†æµç¨‹**ï¼š
```
TikHub API â†’ collector.py â†’ pipeline.py â†’ MongoDB Atlas
                                â†•
                          analyzer.py (åˆ†æ + åŠ å·¥)
```

**API ç«¯ç‚¹**ï¼š
- ç¬”è®°åˆ—è¡¨ï¼š`https://api.tikhub.io/api/v1/xiaohongshu/web/get_user_notes_v2`
- ç”¨æˆ·ä¿¡æ¯ï¼š`https://api.tikhub.io/api/v1/xiaohongshu/web_v2/fetch_user_info_app`

---

## 5. å‰ç«¯æ¶æ„

### 5.1 è·¯ç”±ç»“æ„

å‰ç«¯ä½¿ç”¨ Next.js App Router + `next-intl` å›½é™…åŒ–è·¯ç”±ã€‚

| è·¯ç”± | ç»„ä»¶ | è¯´æ˜ |
|------|------|------|
| `/` | â€” | é‡å®šå‘åˆ° `/zh` |
| `/[locale]` | `HomePage` | é¦–é¡µï¼ˆè‹±é›„åŒº + åˆ›ä½œè€…ç½‘ç»œå›¾ï¼‰ |
| `/[locale]/content-studio` | `ContentStudio` | å†…å®¹å·¥ä½œå®¤ï¼ˆ4 æ­¥å·¥ä½œæµï¼‰ |
| `/[locale]/growth-path` | `ContentStudio` | æˆé•¿è·¯å¾„é¡µé¢ |
| `/[locale]/style-generator` | `ContentStudio` | é£æ ¼ç”Ÿæˆå™¨é¡µé¢ |

**è¯­è¨€é…ç½®**ï¼š
- æ”¯æŒè¯­è¨€ï¼š`zh`ï¼ˆä¸­æ–‡ï¼Œé»˜è®¤ï¼‰ã€`en`ï¼ˆè‹±æ–‡ï¼‰
- ç¿»è¯‘æ–‡ä»¶ï¼š`messages/zh.json`ã€`messages/en.json`
- ä¸­é—´ä»¶ï¼šè‡ªåŠ¨æ£€æµ‹è¯­è¨€å¹¶é‡å®šå‘

### 5.2 ç»„ä»¶åˆ—è¡¨

#### æ ¸å¿ƒç»„ä»¶

| ç»„ä»¶ | æ–‡ä»¶ | è¯´æ˜ |
|------|------|------|
| `HomePage` | `src/components/HomePage.tsx` | é¦–é¡µå¸ƒå±€ï¼šè‹±é›„åŒº + åˆ›ä½œè€…ç½‘ç»œ + è¯¦æƒ…é¢æ¿ |
| `ContentStudio` | `src/components/ContentStudio.tsx` | å†…å®¹å·¥ä½œå®¤ï¼š4 æ­¥ Wizard å·¥ä½œæµ |
| `CreatorNetworkGraph` | `src/components/CreatorNetworkGraph.tsx` | D3 åŠ›å°å‘å…³ç³»ç½‘ç»œå›¾ |
| `CreatorUniverse` | `src/components/CreatorUniverse.tsx` | åˆ›ä½œè€…å®‡å®™è§†å›¾ |
| `Header` | `src/components/Header.tsx` | é¡¶éƒ¨å¯¼èˆªæ  |
| `LanguageSwitcher` | `src/components/LanguageSwitcher.tsx` | ä¸­è‹±æ–‡åˆ‡æ¢æŒ‰é’® |

#### å·¥ä½œæµæ­¥éª¤ç»„ä»¶ (`workflow/`)

| ç»„ä»¶ | æ–‡ä»¶ | è¯´æ˜ |
|------|------|------|
| `StepSelectCreator` | `workflow/StepSelectCreator.tsx` | æ­¥éª¤ 1: é€‰æ‹©è¦æ¨¡ä»¿çš„åˆ›ä½œè€… |
| `StepMatchCreators` | `workflow/StepMatchCreators.tsx` | æ­¥éª¤ 2: åŒ¹é…ç›¸ä¼¼åˆ›ä½œè€… |
| `StepDiscoverContent` | `workflow/StepDiscoverContent.tsx` | æ­¥éª¤ 3: å‘ç°å†…å®¹çµæ„Ÿ |
| `StepGenerateContent` | `workflow/StepGenerateContent.tsx` | æ­¥éª¤ 4: AI ç”Ÿæˆå†…å®¹ |

### 5.3 API ä»£ç†è·¯ç”±

å‰ç«¯é€šè¿‡ Next.js API Routes ä»£ç†åç«¯è¯·æ±‚ï¼ˆè§£å†³ CORS å’Œç¯å¢ƒå·®å¼‚ï¼‰ï¼š

| å‰ç«¯è·¯ç”± | ä»£ç†ç›®æ ‡ | è¯´æ˜ |
|---------|---------|------|
| `GET /api/creators` | `http://localhost:8000/api/creators/network` | è·å–åˆ›ä½œè€…ç½‘ç»œ |
| `GET /api/style/creators` | `http://localhost:8000/api/style/creators` | è·å–å¯æ¨¡ä»¿åˆ›ä½œè€… |

**ç¯å¢ƒå˜é‡**ï¼š
- `API_URL` / `NEXT_PUBLIC_API_URL`ï¼šåç«¯ API åœ°å€ï¼ˆé»˜è®¤ `http://localhost:8000`ï¼‰
- `NEXT_PUBLIC_API_BASE_URL`ï¼šå®¢æˆ·ç«¯ç›´è¿ API åœ°å€

### 5.4 å›½é™…åŒ– (i18n)

| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| `src/i18n.ts` | `getRequestConfig` é…ç½®ï¼ŒåŠ è½½å¯¹åº”è¯­è¨€çš„æ¶ˆæ¯æ–‡ä»¶ |
| `src/middleware.ts` | è¯­è¨€æ£€æµ‹ä¸­é—´ä»¶ï¼Œé»˜è®¤ `zh`ï¼Œæ”¯æŒ `en` |
| `src/navigation.ts` | å¯¼èˆªå·¥å…·ï¼ˆ`Link`, `useRouter`, `usePathname`, `redirect`ï¼‰ |
| `messages/zh.json` | ä¸­æ–‡ç¿»è¯‘ï¼ˆ55 è¡Œï¼Œè¦†ç›–é¦–é¡µ + å¯¼èˆª + åˆ›ä½œè€…è¯¦æƒ…ï¼‰ |
| `messages/en.json` | è‹±æ–‡ç¿»è¯‘ï¼ˆ55 è¡Œï¼Œå¯¹åº” zh.jsonï¼‰ |

---

## 6. æ•°æ®åº“è®¾è®¡

### 6.1 MongoDB é›†åˆåˆ—è¡¨

æ•°æ®åº“åï¼š**`tikhub_xhs`**ï¼ˆMongoDB Atlasï¼‰

| é›†åˆå | è¯´æ˜ | æ•°æ®æ¥æº | ä½¿ç”¨é¢‘ç‡ |
|--------|------|---------|---------|
| `creator_networks` | â­ åˆ›ä½œè€…å…³ç³»ç½‘ç»œï¼ˆèŠ‚ç‚¹ + è¾¹ + ç»Ÿè®¡ï¼‰ | è„šæœ¬ç”Ÿæˆ | **é«˜ï¼ˆä¸»è¦æ•°æ®æºï¼‰** |
| `user_profiles` | ç”¨æˆ·æ¡£æ¡ˆï¼ˆä¸»é¢˜ã€é£æ ¼ã€ä»·å€¼ç‚¹ï¼‰ | é‡‡é›† + AI åˆ†æ | ä½ï¼ˆSSL è¶…æ—¶ï¼‰ |
| `user_snapshots` | ç”¨æˆ·ç¬”è®°å¿«ç…§ï¼ˆåŸå§‹ç¬”è®°æ•°æ®ï¼‰ | TikHub é‡‡é›† | ä½ï¼ˆSSL è¶…æ—¶ï¼‰ |
| `user_embeddings` | ç”¨æˆ·å‘é‡åµŒå…¥ï¼ˆ512 ç»´ï¼‰ | è„šæœ¬ç”Ÿæˆ | ä¸­ |
| `style_prompts` | é£æ ¼ç”Ÿæˆæç¤ºè¯æ¨¡æ¿ | æ‰‹åŠ¨é…ç½® | ä¸­ |
| `platform_configs` | å¹³å° API é…ç½® | æ‰‹åŠ¨é…ç½® | ä½ |
| `user_personas` | AI ç”Ÿæˆçš„ç”¨æˆ·ç”»åƒ | AI åˆ†æ | ä¸­ |
| `llm_cache` | LLM è°ƒç”¨ç¼“å­˜ | è‡ªåŠ¨ç¼“å­˜ | é«˜ï¼ˆ24h TTLï¼‰ |
| `llm_usage_logs` | LLM ä½¿ç”¨é‡æ—¥å¿— | è‡ªåŠ¨è®°å½• | ä½ |
| `task_logs` | ä»»åŠ¡æ‰§è¡Œæ—¥å¿— | è‡ªåŠ¨è®°å½• | ä½ |

> **âš ï¸ é‡è¦**ï¼šç”±äº MongoDB Atlas SSL æ¡æ‰‹è¶…æ—¶é—®é¢˜ï¼Œå½“å‰æ‰€æœ‰é«˜é¢‘è¯»å–è·¯å¾„å·²è¿ç§»åˆ° `creator_networks` é›†åˆã€‚`user_profiles` å’Œ `user_snapshots` ä»…åœ¨è„šæœ¬ä¸­ä½¿ç”¨ã€‚

### 6.2 Repository å±‚æ˜ å°„

| Repository ç±» | é›†åˆ | ä¸»è¦æ–¹æ³• |
|---------------|------|---------|
| `UserProfileRepository` | `user_profiles` | `get_by_user_id()`, `upsert()`, `get_all()` |
| `UserSnapshotRepository` | `user_snapshots` | `get_latest()`, `save()`, `get_all()` |
| `UserEmbeddingRepository` | `user_embeddings` | `get_by_user_id()`, `upsert()`, `find_similar()` |
| `CreatorNetworkRepository` | `creator_networks` | `get_latest()`, `save()`, `get_by_platform()` |
| `StylePromptRepository` | `style_prompts` | `get_by_type()`, `create()`, `get_all()` |
| `PlatformConfigRepository` | `platform_configs` | `get_by_platform()`, `upsert()` |

### 6.3 æ•°æ®æ¨¡å‹å®šä¹‰

**æ–‡ä»¶**: `backend/database/models.py`ï¼ˆ16 ä¸ª Pydantic æ¨¡å‹ï¼‰

| æ¨¡å‹ | è¯´æ˜ |
|------|------|
| `PlatformType` | å¹³å°æšä¸¾ï¼š`xiaohongshu`, `instagram` |
| `UserProfile` | ç”¨æˆ·æ¡£æ¡ˆï¼šå¹³å°ã€IDã€æ˜µç§°ã€æ¡£æ¡ˆæ•°æ® |
| `UserProfileData` | æ¡£æ¡ˆè¯¦æƒ…ï¼šä¸»é¢˜ã€é£æ ¼ã€ä»·å€¼ç‚¹ã€äº’åŠ¨æ•°æ® |
| `UserSnapshot` | ç¬”è®°å¿«ç…§ï¼šå¹³å°ã€ç”¨æˆ·ã€ç¬”è®°åˆ—è¡¨ |
| `NoteData` | ç¬”è®°æ•°æ®ï¼šIDã€æ ‡é¢˜ã€æè¿°ã€äº’åŠ¨é‡ |
| `UserEmbedding` | å‘é‡åµŒå…¥ï¼šç”¨æˆ· IDã€512 ç»´æµ®ç‚¹æ•°ç»„ |
| `CreatorNode` | åˆ›ä½œè€…èŠ‚ç‚¹ï¼šIDã€åç§°ã€å¹³å°ã€åˆ†ç±» |
| `CreatorEdge` | å…³ç³»è¾¹ï¼šæºã€ç›®æ ‡ã€ç›¸ä¼¼åº¦ã€æ ‡ç­¾ |
| `CreatorNetwork` | ç½‘ç»œæ•°æ®ï¼šå¹³å°ã€ç½‘ç»œæ•°æ® JSON |
| `StylePrompt` | æç¤ºè¯æ¨¡æ¿ï¼šå¹³å°ã€ç±»å‹ã€æ¨¡æ¿å†…å®¹ |
| `StylePromptType` | æ¨¡æ¿ç±»å‹æšä¸¾ |
| `PlatformConfig` | å¹³å°é…ç½®ï¼šAPI é…ç½®ã€è®¤è¯ |
| `PlatformAPIConfig` | API é…ç½®ï¼šURLã€ç«¯ç‚¹ã€è¯·æ±‚å¤´ |
| `UserPersona` | ç”¨æˆ·ç”»åƒï¼šæ ‡ç­¾ã€ä¸»é¢˜ã€é£æ ¼ã€æ´»è·ƒæ¨¡å¼ |
| `PersonaTag` | ç”»åƒæ ‡ç­¾ï¼šåç§°ã€æƒé‡ã€åˆ†ç±» |
| `ActivityPattern` | æ´»è·ƒæ¨¡å¼ï¼šé«˜å³°æ—¶æ®µã€æ´»è·ƒæ—¥æœŸ |
| `AudienceProfile` | å—ä¼—ç”»åƒï¼šå¹´é¾„ã€æ€§åˆ«ã€å…´è¶£ |

### 6.4 æ•°æ®æµå‘å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TikHub API  â”‚â”€â”€â”€â”€â–¶â”‚  collector   â”‚â”€â”€â”€â”€â–¶â”‚  user_snapshots    â”‚
â”‚ (å°çº¢ä¹¦æ•°æ®) â”‚     â”‚  pipeline    â”‚     â”‚  user_profiles     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                   â”‚
                                          è„šæœ¬å¤„ç†  â–¼
                                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                         â”‚  regenerate_creator  â”‚
                                         â”‚  _networks.py        â”‚
                                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                   â”‚
                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                           â”‚         creator_networks                  â”‚
                           â”‚  (èŠ‚ç‚¹ + è¾¹ + indexSeries + ç»Ÿè®¡)         â”‚
                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                   â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚              FastAPI Backend                     â”‚
                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
                    â”‚  â”‚ style_serviceâ”‚  â”‚creator_routerâ”‚             â”‚
                    â”‚  â”‚ (AI ç”Ÿæˆ)   â”‚  â”‚ (ç½‘ç»œæ•°æ®)    â”‚             â”‚
                    â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
                    â”‚         â”‚                â”‚                      â”‚
                    â”‚    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”           â”‚                      â”‚
                    â”‚    â”‚DeepSeek â”‚           â”‚                      â”‚
                    â”‚    â”‚LLM API  â”‚           â”‚                      â”‚
                    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚                      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â”‚
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚  Next.js Frontend   â”‚
                                    â”‚  (API ä»£ç† + SSR)   â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. ç¯å¢ƒå˜é‡é…ç½®

æ‰€æœ‰ç¯å¢ƒå˜é‡åœ¨ `.env` æ–‡ä»¶ä¸­é…ç½®ï¼Œé€šè¿‡ `backend/core/config.py` (Pydantic Settings) ç®¡ç†ã€‚

### å¿…éœ€å˜é‡

| å˜é‡å | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|
| `MONGO_URI` | MongoDB Atlas è¿æ¥ URI | `mongodb+srv://user:pass@cluster.mongodb.net/` |
| `DEEPSEEK_API_KEY` | DeepSeek API å¯†é’¥ | `sk-xxxxxxxx` |

### å¯é€‰å˜é‡ï¼ˆæœ‰é»˜è®¤å€¼ï¼‰

| å˜é‡å | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|--------|------|
| `DATABASE_NAME` | `tikhub_xhs` | MongoDB æ•°æ®åº“å |
| `DEEPSEEK_BASE_URL` | `https://api.deepseek.com` | DeepSeek API åœ°å€ |
| `TIKHUB_TOKEN` | â€” | TikHub API ä»¤ç‰Œï¼ˆé‡‡é›†ç”¨ï¼‰ |
| `ENV` | `development` | è¿è¡Œç¯å¢ƒ |
| `DEBUG` | `true` | è°ƒè¯•æ¨¡å¼ |
| `HOST` | `0.0.0.0` | æœåŠ¡å™¨ç›‘å¬åœ°å€ |
| `PORT` | `5001` | æœåŠ¡å™¨ç«¯å£ï¼ˆå®é™…å¯åŠ¨ç”¨ 8000ï¼‰ |
| `CORS_ORIGINS` | `localhost:3000,8000` | CORS ç™½åå• |
| `CHAT_MODEL` | `deepseek-chat` | LLM æ¨¡å‹å |
| `EMBEDDING_MODEL` | `BAAI/bge-small-zh-v1.5` | åµŒå…¥æ¨¡å‹å |
| `EMBEDDING_DIMENSION` | `512` | å‘é‡ç»´åº¦ |
| `LOG_LEVEL` | `INFO` | æ—¥å¿—çº§åˆ« |
| `LOG_FILE` | `backend_server.log` | æ—¥å¿—æ–‡ä»¶ |
| `STORAGE_TYPE` | `local` | å­˜å‚¨ç±»å‹ |
| `STORAGE_DIR` | `/tmp/xhs_storage` | æœ¬åœ°å­˜å‚¨è·¯å¾„ |
| `S3_ENDPOINT` | â€” | S3 ç«¯ç‚¹ |
| `S3_ACCESS_KEY` | â€” | S3 è®¿é—®å¯†é’¥ |
| `S3_SECRET_KEY` | â€” | S3 ç§é’¥ |
| `S3_BUCKET` | â€” | S3 å­˜å‚¨æ¡¶ |

### å‰ç«¯ç¯å¢ƒå˜é‡

| å˜é‡å | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|--------|------|
| `API_URL` | `http://localhost:8000` | åç«¯ API åœ°å€ï¼ˆæœåŠ¡ç«¯ç”¨ï¼‰ |
| `NEXT_PUBLIC_API_URL` | `http://localhost:8000` | åç«¯ API åœ°å€ï¼ˆå…¼å®¹ï¼‰ |
| `NEXT_PUBLIC_API_BASE_URL` | `http://localhost:8000` | å®¢æˆ·ç«¯ç›´è¿ API |

---

## 8. åç«¯è„šæœ¬å·¥å…·

**ç›®å½•**: `backend/scripts/`

| è„šæœ¬ | è¯´æ˜ | ä½¿ç”¨åœºæ™¯ |
|------|------|---------|
| `regenerate_creator_networks.py` | â­ é‡æ–°ç”Ÿæˆåˆ›ä½œè€…å…³ç³»ç½‘ç»œ | æ•°æ®æ›´æ–°åè¿è¡Œ |
| `create_indexes.py` | åˆ›å»º MongoDB ç´¢å¼• | é¦–æ¬¡éƒ¨ç½² |
| `generate_missing_embeddings.py` | ä¸ºç¼ºå¤±ç”¨æˆ·ç”Ÿæˆå‘é‡åµŒå…¥ | æ–°å¢ç”¨æˆ·å |
| `unify_embeddings_512.py` | ç»Ÿä¸€å‘é‡åˆ° 512 ç»´ | æ¨¡å‹è¿ç§» |
| `unify_to_512_complete.py` | å®Œæ•´çš„ 512 ç»´ç»Ÿä¸€è„šæœ¬ | æ¨¡å‹è¿ç§» |
| `continue_512.py` | ç»§ç»­æœªå®Œæˆçš„ 512 ç»´è½¬æ¢ | ä¸­æ–­æ¢å¤ |
| `add_prompt_templates.py` | æ·»åŠ é»˜è®¤æç¤ºè¯æ¨¡æ¿ | åˆå§‹åŒ– |
| `add_founder_template.py` | æ·»åŠ åˆ›å§‹äººæç¤ºè¯æ¨¡æ¿ | åˆå§‹åŒ– |
| `populate_followers.py` | å¡«å……ç²‰ä¸æ•°æ® | æ•°æ®è¡¥å…¨ |
| `update_profile_stats.py` | æ›´æ–°ç”¨æˆ·ç»Ÿè®¡æ•°æ® | å®šæœŸç»´æŠ¤ |
| `refresh_all_users.py` | åˆ·æ–°æ‰€æœ‰ç”¨æˆ·ä¿¡æ¯ | å®šæœŸç»´æŠ¤ |
| `sync_user_info_from_api.py` | ä» API åŒæ­¥ç”¨æˆ·ä¿¡æ¯ | æ•°æ®åŒæ­¥ |
| `init_network_from_existing.py` | ä»ç°æœ‰æ•°æ®åˆå§‹åŒ–ç½‘ç»œ | é¦–æ¬¡åˆå§‹åŒ– |
| `match_profiles_to_snapshots.py` | å…³è”æ¡£æ¡ˆå’Œå¿«ç…§æ•°æ® | æ•°æ®ä¿®å¤ |
| `process_all_snapshots.py` | å¤„ç†æ‰€æœ‰å¿«ç…§æ•°æ® | æ‰¹é‡å¤„ç† |
| `quick_generate_network.py` | å¿«é€Ÿç”Ÿæˆç½‘ç»œï¼ˆè°ƒè¯•ç”¨ï¼‰ | å¼€å‘è°ƒè¯• |
| `analyze_database.py` | åˆ†ææ•°æ®åº“çŠ¶æ€ | é—®é¢˜æ’æŸ¥ |
| `test_mongodb_performance.py` | æµ‹è¯• MongoDB æ€§èƒ½ | æ€§èƒ½è°ƒä¼˜ |
| `test_user_info_api.py` | æµ‹è¯•ç”¨æˆ·ä¿¡æ¯ API | API è°ƒè¯• |
| `verify_final_status.py` | éªŒè¯æœ€ç»ˆæ•°æ®çŠ¶æ€ | ä¸Šçº¿æ£€æŸ¥ |

---

## 9. éƒ¨ç½²è¯´æ˜

### æœ¬åœ°å¼€å‘

```bash
# 1. é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
# ç¼–è¾‘ .env å¡«å…¥ MONGO_URI å’Œ DEEPSEEK_API_KEY

# 2. å¯åŠ¨åç«¯
cd backend
python -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
bash start_server.sh
# åç«¯è¿è¡Œåœ¨ http://localhost:8000

# 3. å¯åŠ¨å‰ç«¯
cd xhs-analyser-frontend
pnpm install
pnpm dev
# å‰ç«¯è¿è¡Œåœ¨ http://localhost:3000
```

### Vercel éƒ¨ç½²ï¼ˆå‰ç«¯ï¼‰

- é…ç½®æ–‡ä»¶ï¼š`vercel.json`
- æ„å»ºå‘½ä»¤ï¼š`pnpm run build`
- å®‰è£…å‘½ä»¤ï¼š`pnpm install`
- éœ€è®¾ç½®ç¯å¢ƒå˜é‡ `API_URL` æŒ‡å‘åç«¯

### Docker éƒ¨ç½²ï¼ˆåç«¯ï¼‰

- Dockerfile ä½äº `backend/Dockerfile`

---

## 10. å·²çŸ¥é—®é¢˜ä¸æ³¨æ„äº‹é¡¹

### MongoDB Atlas SSL è¶…æ—¶

- **ç°è±¡**ï¼šé¦–æ¬¡æŸ¥è¯¢ `user_profiles`ã€`user_snapshots` é›†åˆæ—¶ SSL æ¡æ‰‹è¶…æ—¶ï¼ˆ~28 ç§’ï¼‰
- **ç¼“è§£æªæ–½**ï¼š
  - è¿æ¥è¶…æ—¶é…ç½®ï¼š`serverSelectionTimeoutMS=5000`
  - æ‰€æœ‰é«˜é¢‘è¯»å–è·¯å¾„å·²è¿ç§»åˆ° `creator_networks` é›†åˆ
  - `creator_router` ä½¿ç”¨ 5 åˆ†é’Ÿå†…å­˜ç¼“å­˜
  - `style_service` åˆ›ä½œè€…åˆ—è¡¨å¸¦ç¼“å­˜

### æ•°æ®è¯»å–è·¯å¾„å˜æ›´

- `get_available_creators()` â†’ ä» `creator_networks` è¯»å–ï¼ˆä¸å†æŸ¥ `user_profiles`ï¼‰
- `load_creator_profile()` â†’ ä» `creator_networks` è¯»å–
- `load_creator_notes()` â†’ ä» `creator_networks.indexSeries` è¯»å–

### å‰ç«¯æ³¨æ„äº‹é¡¹

- Next.js 16+ çš„ `params` æ˜¯ Promiseï¼Œéœ€è¦ `await`
- `next.config.ts` ä¸­ `ignoreBuildErrors: true` è·³è¿‡äº† TypeScript æ£€æŸ¥
- Google Fonts (Inter + Poppins) é€šè¿‡ `<link>` æ ‡ç­¾åœ¨ `layout.tsx` ä¸­åŠ è½½
- `src/data/creators.ts` ä¸­çš„é™æ€æ•°æ®å·²è¢« API æ•°æ®æ›¿ä»£ï¼Œä»…ä½œä¸ºç±»å‹å®šä¹‰å‚è€ƒ
